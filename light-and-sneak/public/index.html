<!DOCTYPE html>
<html>
<head>
    <title>Light and Sneak</title>
    <script src="//cdn.jsdelivr.net/npm/phaser-ce@2.9.2"></script>
    <script src="./player.js"></script>
    <script src="./dynamicObject.js"></script>
    <script src="./staticObject.js"></script>
    <script src="./map.js"></script>
	  <script src="./light.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>


<script type = "text/javascript" src = "Lights.js"></script>   

<script type="text/javascript">

    // create a global scall ratio that'll apply to all assets in the game
    var scaleRatio = window.devicePixelRatio / 3;
    // setting the canvas to be the width and height of the device

    var game = new Phaser.Game(736, 414, Phaser.CANVAS, '', { preload: preload, create: create, update: update });

    var lightPacket = new Lights(game);


    // this initilizes the game objects
    function preload() {
        //game.load.image('hider', 'assets/hider.png');
        game.load.image('background', 'assets/background.png');
        game.load.image('metalCrate_01', 'assets/crateMetal_01.png' );
        game.load.image('metalCrate_02', 'assets/crateMetal_02.png' );
        game.load.image('metalCrate_03', 'assets/crateMetal_03.png' );
        game.load.image('metalCrate_04', 'assets/crateMetal_04.png' );
        game.load.image('metalCrate_05', 'assets/crateMetal_05.png' );
        game.load.image('metalCrate_06', 'assets/crateMetal_06.png' );
        game.load.image('woodenCrate', 'assets/crateWood.png');
        game.load.image('spaceCrate', 'assets/spaceCrate.png');
        game.load.image('wall', 'assets/wallTile.png')
        game.load.spritesheet('hiderSheet', 'assets/hider-spriteSheet.png',50,50);
        game.load.spritesheet('seekerSheet', 'assets/seeker-spriteSheet.png',50,50);
        
    }

    var walls;
    var gameObjects;
    var woodenCrate;
    var player;

	  var lightarray;
    var cursors;

    function create() {
        // set the physics to be P2
        game.physics.startSystem(Phaser.Physics.P2JS);
        // set the friction of the game world
        game.physics.p2.world.defaultContactMaterial.friction = 1;
        //game.physics.p2.restitution = 0.9;
        game.physics.p2.world.setGlobalStiffness(1e5);
        
        background = game.add.sprite(0,0, 'background');
        
        seeker = new Seeker(game, 100, 50, 'seekerSheet');
      
        walls = createWalls(game);
        gameObjects = createObjects(game);
    		
	      lightPacket.setupBackground();
        cursors = game.input.keyboard.createCursorKeys();

        lightarray = createLights(game);

        woodenCrate  = game.add.sprite(game.world.centerX - (50 * i), game.world.centerY, 'woodenCrate' );
        game.physics.p2.enable(woodenCrate);
        woodenCrate.body.static = true;

    }
    

    function update () {

		lightPacket.lightUpdate(woodenCrate,lightarray, player,true);
      
    }
  
</script>

</body>
</html>
